<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI NFT Generator - Create Your NFT Collection on TON Testnet</title>
    <meta name="description" content="No-code AI NFT generator to create and mint unique NFT collections on TON Testnet. Upload or generate images easily.">
    <meta name="keywords" content="AI NFT generator, create NFT, NFT minter, TON Testnet, no-code NFT, NFT collection, AI art, mint NFT">
    <meta name="author" content="NFT Minter Team">
    <meta name="robots" content="index, follow">
    <!-- Open Graph Tags for Social Media -->
    <meta property="og:title" content="AI NFT Generator - Create Your NFT Collection on TON Testnet">
    <meta property="og:description" content="No-code AI NFT generator to create and mint unique NFT collections on TON Testnet. Upload or generate images easily.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nft-minter-production.up.railway.app/">
    <meta property="og:image" content="https://nft-minter-production.up.railway.app/static/og-image.jpg">
    <meta property="og:site_name" content="NFT Minter">
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI NFT Generator - Create Your NFT Collection on TON Testnet">
    <meta name="twitter:description" content="No-code AI NFT generator to create and mint unique NFT collections on TON Testnet. Upload or generate images easily.">
    <meta name="twitter:image" content="https://nft-minter-production.up.railway.app/static/og-image.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'okx-blue': '#1E40AF',
                        'okx-purple': '#6B21A8',
                    },
                },
            },
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.22.5/babel.min.js"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function App() {
            const [step1Expanded, setStep1Expanded] = useState(true);
            const [step2Expanded, setStep2Expanded] = useState(false);
            const [prompt, setPrompt] = useState("");
            const [editMode, setEditMode] = useState(false);
            const [tonAddress, setTonAddress] = useState("");
            const [imageUrl, setImageUrl] = useState("");
            const [filename, setFilename] = useState("");
            const [message, setMessage] = useState("");
            const [loading, setLoading] = useState(false);
            const [ipfsImage, setIpfsImage] = useState("");
            const [ipfsMetadata, setIpfsMetadata] = useState("");
            const [nftUrl, setNftUrl] = useState("");
            const [toast, setToast] = useState("");
            const [logs, setLogs] = useState([]);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [activeSidebarTab, setActiveSidebarTab] = useState("logs");
            const fileInputRef = useRef(null);
            const [activeTab, setActiveTab] = useState("generate");

            useEffect(() => {
                if (toast) {
                    setLogs((prevLogs) => [...prevLogs, { message: toast, timestamp: new Date().toLocaleTimeString() }]);
                    const timer = setTimeout(() => setToast(""), 3000);
                    return () => clearTimeout(timer);
                }
            }, [toast]);

            const generateImage = async () => {
                setLoading(true);
                setMessage("");
                try {
                    const response = await axios.post("/generate-image", { prompt });
                    const timestamp = Date.now();
                    setImageUrl(`/image/${response.data.filename}?t=${timestamp}`);
                    setFilename(response.data.filename);
                    setToast(response.data.message);
                    setEditMode(false);
                    setStep1Expanded(true);
                    setStep2Expanded(true);
                } catch (error) {
                    const errorMessage = error.response?.data?.detail?.[0]?.msg || error.response?.data?.detail || error.response?.data?.error || error.message || JSON.stringify(error.response?.data || error);
                    setToast(`Error: ${errorMessage}`);
                    console.error("Generate Image Error:", error, error.response?.data);
                } finally {
                    setLoading(false);
                }
            };

            const uploadImage = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setLoading(true);
                setMessage("");
                try {
                    const formData = new FormData();
                    formData.append("file", file);
                    const response = await axios.post("/upload-image", formData, {
                        headers: { "Content-Type": "multipart/form-data" },
                    });
                    const timestamp = Date.now();
                    setImageUrl(`/image/${response.data.filename}?t=${timestamp}`);
                    setFilename(response.data.filename);
                    setToast(response.data.message);
                    setPrompt("");
                    setStep1Expanded(true);
                    setStep2Expanded(true);
                } catch (error) {
                    const errorMessage = error.response?.data?.detail?.[0]?.msg || error.response?.data?.detail || error.response?.data?.error || error.message || JSON.stringify(error.response?.data || error);
                    setToast(`Error: ${errorMessage}`);
                    console.error("Upload Image Error:", error, error.response?.data);
                } finally {
                    setLoading(false);
                    if (fileInputRef.current) fileInputRef.current.value = "";
                }
            };

            const regenerateImage = () => {
                generateImage();
            };

            const editPrompt = () => {
                setEditMode(true);
            };

            const uploadToIpfs = async () => {
                if (!filename) {
                    setToast("Please generate or upload an image first");
                    return;
                }
                setLoading(true);
                setMessage("");
                try {
                    console.log("Sending to /upload-to-ipfs:", { filename, prompt: prompt || null });
                    const response = await axios.post("/upload-to-ipfs", { filename, prompt: prompt || null });
                    console.log("IPFS upload response:", response.data);
                    setIpfsImage(response.data.ipfs_image);
                    setIpfsMetadata(response.data.ipfs_metadata);
                    setFilename(response.data.filename);
                    setToast("Image and metadata uploaded to IPFS");
                } catch (error) {
                    const errorMessage = error.response?.data?.detail?.[0]?.msg || error.response?.data?.detail || error.response?.data?.error || error.message || JSON.stringify(error.response?.data || error);
                    setToast(`Error: ${errorMessage}`);
                    console.error("IPFS Upload Error:", error, error.response?.data);
                } finally {
                    setLoading(false);
                }
            };

            const mintNFT = async () => {
                if (!filename) {
                    setToast("Please generate or upload an image first");
                    return;
                }
                setLoading(true);
                setMessage("");
                try {
                    const response = await axios.post("/mint-nft", { address: tonAddress || null, filename, prompt: prompt || null });
                    setMessage(response.data.message);
                    setNftUrl(response.data.url);
                    setIpfsImage(response.data.ipfs_image);
                    setIpfsMetadata(response.data.ipfs_metadata);
                    setToast(response.data.message);
                } catch (error) {
                    const errorMessage = error.response?.data?.detail?.[0]?.msg || error.response?.data?.detail || error.response?.data?.error || error.message || JSON.stringify(error.response?.data || error);
                    setToast(`Error: ${errorMessage}`);
                    console.error("Mint NFT Error:", error, error.response?.data);
                } finally {
                    setLoading(false);
                }
            };

            const handleTabChange = (tab) => {
                setActiveTab(tab);
                if (tab === "generate") {
                    setFilename(""); // Reset filename to enable input and button
                    setImageUrl("");
                    setEditMode(false);
                    setPrompt("");
                }
            };

            return (
                <div className="container mx-auto p-6 max-w-3xl bg-gray-800 rounded-xl shadow-2xl">
                    <h1 className="text-4xl font-bold mb-6 text-center text-white">NFT Minter - Powered by TON Testnet</h1>
                    <p className="text-gray-300 mb-6 text-center">
                        Generate or upload an image, then mint it as an NFT on TON Testnet. Use a Testnet TON wallet address. If no address provided, NFT mints to default collection.
                    </p>

                    <div className="space-y-4">
                        <div className="bg-gray-700 rounded-lg">
                            <button
                                onClick={() => setStep1Expanded(!step1Expanded)}
                                className="w-full flex justify-between p-4 text-left text-xl font-semibold text-white hover:bg-gray-600 rounded-t-lg"
                            >
                                Step 1: Generate or Upload Image & Upload to IPFS
                                <span>{step1Expanded ? '-' : '+'}</span>
                            </button>
                            {step1Expanded && (
                                <div className="p-4">
                                    <div className="flex mb-4">
                                        <button
                                            onClick={() => handleTabChange("generate")}
                                            className={`flex-1 p-2 rounded-l-lg ${activeTab === "generate" ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"}`}
                                        >
                                            Generate Image
                                        </button>
                                        <button
                                            onClick={() => handleTabChange("upload")}
                                            className={`flex-1 p-2 rounded-r-lg ${activeTab === "upload" ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"}`}
                                        >
                                            Upload Image
                                        </button>
                                    </div>
                                    <div className="min-h-[150px] flex flex-col">
                                        {activeTab === "generate" && (
                                            <>
                                                <p className="text-gray-400 mb-2">Enter a prompt to generate your NFT image (e.g., "owl in cyberpunk style").</p>
                                                <input
                                                    type="text"
                                                    value={prompt}
                                                    onChange={(e) => setPrompt(e.target.value)}
                                                    placeholder="Enter image prompt"
                                                    className="mt-1 block w-full p-3 bg-gray-700 border border-gray-600 rounded text-white"
                                                    disabled={!editMode && filename}
                                                />
                                                <button
                                                    onClick={generateImage}
                                                    disabled={loading || !prompt}
                                                    className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 rounded mt-4 hover:shadow-lg disabled:bg-gray-600"
                                                >
                                                    {loading ? "Generating..." : editMode ? "Save & Generate" : "Generate Image"}
                                                </button>
                                            </>
                                        )}
                                        {activeTab === "upload" && (
                                            <>
                                                <label className="block text-sm font-medium text-gray-300">Upload Image</label>
                                                <input
                                                    type="file"
                                                    accept="image/png,image/jpeg"
                                                    onChange={uploadImage}
                                                    ref={fileInputRef}
                                                    className="mt-1 block w-full p-3 bg-gray-700 border border-gray-600 rounded text-white"
                                                    disabled={loading}
                                                />
                                                <p className="text-gray-400 text-sm mt-2">
                                                    Recommended for NFT images: PNG or JPEG, max 5MB, 512x512 or higher resolution, clear and unique artwork. Square images work best for NFT platforms.
                                                </p>
                                            </>
                                        )}
                                    </div>
                                    {imageUrl && (
                                        <div className="mt-4">
                                            <img src={imageUrl} alt="Generated or Uploaded" className="w-full rounded" onError={() => setToast("Failed to load image")} />
                                            <div className="flex mt-2 space-x-2">
                                                {activeTab === "generate" && (
                                                    <>
                                                        <button
                                                            onClick={editPrompt}
                                                            className="flex-1 bg-gray-700 text-white p-2 rounded hover:bg-gray-600"
                                                        >
                                                            Edit Prompt
                                                        </button>
                                                        <button
                                                            onClick={regenerateImage}
                                                            className="flex-1 bg-gray-700 text-white p-2 rounded hover:bg-gray-600"
                                                        >
                                                            Regenerate
                                                        </button>
                                                    </>
                                                )}
                                                <a
                                                    href={imageUrl}
                                                    download={filename}
                                                    className="flex-1 bg-gray-700 text-white p-2 rounded hover:bg-gray-600 text-center"
                                                >
                                                    Download Image
                                                </a>
                                            </div>
                                            <button
                                                onClick={uploadToIpfs}
                                                disabled={loading}
                                                className="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white p-3 rounded mt-4 hover:shadow-lg disabled:bg-gray-600"
                                            >
                                                {loading ? "Uploading..." : "Upload to IPFS"}
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        <div className="bg-gray-700 rounded-lg">
                            <button
                                onClick={() => setStep2Expanded(!step2Expanded)}
                                className="w-full flex justify-between p-4 text-left text-xl font-semibold text-white hover:bg-gray-600 rounded-t-lg"
                            >
                                Step 2: Enter TON Address & Mint NFT
                                <span>{step2Expanded ? '-' : '+'}</span>
                            </button>
                            {step2Expanded && (
                                <div className="p-4">
                                    <p className="text-gray-400 mb-2">Enter your Testnet TON wallet address (optional). If left blank, NFT mints to default collection.</p>
                                    <input
                                        type="text"
                                        value={tonAddress}
                                        onChange={(e) => setTonAddress(e.target.value)}
                                        placeholder="Enter Testnet TON address (optional)"
                                        className="mt-1 block w-full p-3 bg-gray-700 border border-gray-600 rounded text-white"
                                    />
                                    <button
                                        onClick={mintNFT}
                                        disabled={loading || !filename}
                                        className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 rounded mt-4 hover:shadow-lg disabled:bg-gray-600"
                                    >
                                        {loading ? "Minting..." : "Mint NFT"}
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>

                    <button
                        onClick={() => {
                            setStep1Expanded(true);
                            setStep2Expanded(true);
                        }}
                        className="w-full bg-gray-700 text-white p-3 rounded mt-6 hover:bg-gray-600"
                    >
                        Expand All Steps
                    </button>

                    <div className="lg:hidden mt-6">
                        <h2 className="text-xl font-semibold mb-4">Logs & Results</h2>
                        {message && <p className="text-red-400 mb-2">{message}</p>}
                        {nftUrl && (
                            <p className="text-green-400 mb-2">
                                NFT URL: <a href={nftUrl} target="_blank" className="text-blue-400 underline">{nftUrl}</a>
                            </p>
                        )}
                        {(ipfsImage || ipfsMetadata) && (
                            <div className="text-gray-300">
                                {ipfsImage && <p>IPFS Image: <a href={ipfsImage} target="_blank" className="text-blue-400 underline">{ipfsImage}</a></p>}
                                {ipfsMetadata && <p>IPFS Metadata: <a href={ipfsMetadata} target="_blank" className="text-blue-400 underline">{ipfsMetadata}</a></p>}
                            </div>
                        )}
                    </div>
                    {toast && (
                        <div className="fixed top-4 right-4 bg-green-600 text-white p-4 rounded shadow-lg">
                            {toast}
                        </div>
                    )}
                    <div className="fixed bottom-4 right-4 flex space-x-2">
                        <button
                            onClick={() => {
                                setIsSidebarOpen(true);
                                setActiveSidebarTab("logs");
                            }}
                            className={`p-3 rounded-l-full ${activeSidebarTab === "logs" && isSidebarOpen ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"} text-white shadow-lg hover:shadow-xl`}
                        >
                            Open Logs
                        </button>
                        <button
                            onClick={() => {
                                setIsSidebarOpen(true);
                                setActiveSidebarTab("help");
                            }}
                            className={`p-3 rounded-r-full ${activeSidebarTab === "help" && isSidebarOpen ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"} text-white shadow-lg hover:shadow-xl`}
                        >
                            Help
                        </button>
                    </div>
                    {isSidebarOpen && (
                        <div className="fixed top-0 right-0 h-full w-80 bg-gray-700 p-4 overflow-y-auto shadow-lg">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => setActiveSidebarTab("logs")}
                                        className={`px-4 py-2 ${activeSidebarTab === "logs" ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"} rounded-t-lg text-white`}
                                    >
                                        Logs
                                    </button>
                                    <button
                                        onClick={() => setActiveSidebarTab("help")}
                                        className={`px-4 py-2 ${activeSidebarTab === "help" ? "bg-gradient-to-r from-blue-600 to-purple-600" : "bg-gray-600"} rounded-t-lg text-white`}
                                    >
                                        Help
                                    </button>
                                </div>
                                <button
                                    onClick={() => setIsSidebarOpen(false)}
                                    className="bg-gradient-to-r from-red-600 to-red-800 text-white p-2 rounded-full hover:shadow-lg"
                                >
                                    Close
                                </button>
                            </div>
                            {activeSidebarTab === "logs" && (
                                <div>
                                    <h2 className="text-xl font-semibold mb-4">Logs & Results</h2>
                                    {logs.length > 0 ? (
                                        logs.map((log, index) => (
                                            <p key={index} className={`mb-2 ${log.message.includes("Error") ? "text-red-400" : "text-gray-300"}`}>
                                                [{log.timestamp}] {log.message}
                                            </p>
                                        ))
                                    ) : (
                                        <p className="text-gray-400">No logs yet</p>
                                    )}
                                    {nftUrl && (
                                        <p className="text-green-400 mb-2">
                                            NFT URL: <a href={nftUrl} target="_blank" className="text-blue-400 underline">{nftUrl}</a>
                                        </p>
                                    )}
                                    {(ipfsImage || ipfsMetadata) && (
                                        <div className="text-gray-300">
                                            {ipfsImage && <p>IPFS Image: <a href={ipfsImage} target="_blank" className="text-blue-400 underline">{ipfsImage}</a></p>}
                                            {ipfsMetadata && <p>IPFS Metadata: <a href={ipfsMetadata} target="_blank" className="text-blue-400 underline">{ipfsMetadata}</a></p>}
                                        </div>
                                    )}
                                </div>
                            )}
                            {activeSidebarTab === "help" && (
                                <div>
                                    <h2 className="text-xl font-semibold mb-4">How to Create an NFT</h2>
                                    <ol className="list-decimal pl-5 text-gray-300 space-y-2">
                                        <li>
                                            <strong>Generate or Upload an Image:</strong>
                                            <ul className="list-disc pl-5 mt-1">
                                                <li>In the "Generate Image" tab, enter a prompt (e.g., "owl in cyberpunk style") and click "Generate Image".</li>
                                                <li>In the "Upload Image" tab, upload a PNG or JPEG image (max 5MB, 512x512 or higher recommended).</li>
                                            </ul>
                                        </li>
                                        <li>
                                            <strong>Review and Download:</strong> Once the image is generated or uploaded, it will display. You can download it using the "Download Image" button.
                                        </li>
                                        <li>
                                            <strong>Upload to IPFS:</strong> Click "Upload to IPFS" to store your image and metadata on the InterPlanetary File System for decentralized storage.
                                        </li>
                                        <li>
                                            <strong>Mint Your NFT:</strong> In the "Enter TON Address & Mint NFT" section, optionally enter a Testnet TON wallet address. Click "Mint NFT" to create your NFT on the TON Testnet. If no address is provided, it mints to a default collection.
                                        </li>
                                        <li>
                                            <strong>Check Results:</strong> View logs in the "Logs" tab of the sidebar for details on each step, including IPFS links and NFT URL.
                                        </li>
                                    </ol>
                                    <p className="text-gray-400 mt-4">
                                        <strong>Note:</strong> Ensure your image is clear, unique, and square (e.g., 512x512) for the best NFT results. Use a Testnet TON wallet for minting.
                                    </p>
                                </div>
                            )}
                        </div>
                    )}
                    <footer className="mt-8 py-4 text-center text-gray-400">
                        <p>Contact us: <a href="https://t.me/mike1b" target="_blank" className="text-blue-400 underline">@mike1b</a></p>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>